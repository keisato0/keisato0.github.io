---
title: "回帰"
author: "佐藤"
date: "2020年11月11日"
output: 
  html_document:
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## R Markdown

Rでの回帰表の示し方について書きたい。ここでは線形回帰分析を想定している。回帰表は`{modelsummary}`パッケージが便利だと感じている。`modelsummary::msummary()`は回帰分析の結果のlistを引数にとるので、list形式で分析結果をまとめていくことを大まかな方針とする。

まず下準備する。

```{r}
library(AER)
data("CPS1988")
df <- CPS1988

library(magrittr)
library(tidyverse)
glimpse(df)
summary(df)
```


以下のようにリストにまとめていく。`lm()`の結果は直接listの一要素に納めることもできるので、`result[["Model 1"]] <- lm(formula = wage ~ education, data = df)` のような書き方もできる。しかし`update()`がlmクラスのオブジェクトを必要とするため、計算結果はいったんlmクラスのオブジェクトにしまい、各lmオブジェクトをリストの各要素に納めるというややまだるっこしいやり方をしている。ここは検討の余地ありである。

```{r}
model1 <- lm(formula = wage ~ education, data = df)
model2 <- update(object = model1, formula. = . ~ . + ethnicity)

result <- list()
result[["Model 1"]] <- model1
result[["Model 2"]] <- model2
```

では結果表をみてみよう。

```{r}
library(modelsummary)
msummary(result, stars = T)
```

いい感じに出ているが、もう少し完成度を高めよう。フィッティングの指標はこんなにいらない。

```{r}
gof_df <- modelsummary::gof_map
gof_df$omit[str_detect(gof_df$raw, pattern = "nobs|r.squared") == FALSE] <- TRUE

msummary(result, stars = T, gof_map = gof_df)
```

各関数の書き方についてはhelpを参照。